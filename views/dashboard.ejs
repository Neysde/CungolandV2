<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/dashboard.css" />
    <link rel="stylesheet" href="/css/cungotwitter.css" />
    <!-- Using Montserrat font to match existing theme -->
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="dashboard-container">
      <header class="dashboard-header">
        <h1>Dashboard</h1>
        <p>Create and manage your wiki pages</p>
      </header>

      <main class="dashboard-content">
        <!-- Dashboard Tabs -->
        <div class="dashboard-tabs">
          <button class="tab-btn active" data-tab="create">
            Create New Wiki
          </button>
          <button class="tab-btn" data-tab="manage">Manage Wikis</button>
          <button class="tab-btn" data-tab="twitter">
            Manage ÇüngoTwitter
          </button>
          <button class="tab-btn" data-tab="photos">Manage Photos</button>
        </div>

        <!-- Create Wiki Section -->
        <section id="create-section" class="wiki-creator tab-content active">
          <h2>Create New Wiki</h2>

          <form id="wikiForm" class="wiki-form" enctype="multipart/form-data">
            <!-- Wiki Title Section -->
            <div class="form-section">
              <h3>Title</h3>
              <div class="form-group">
                <label for="wikiTitle">Main Title</label>
                <input
                  type="text"
                  id="wikiTitle"
                  name="title"
                  required
                  placeholder="Enter wiki title"
                />
                <!-- Hidden input for URL slug, automatically generated from title -->
                <input type="hidden" id="wikiUrlHidden" name="urlSlug" />
              </div>
            </div>

            <!-- Info Table Section -->
            <div class="form-section">
              <h3>Info Table</h3>

              <!-- Info Table Image Upload -->
              <div class="form-group">
                <label for="infoImage">Info Table Image</label>
                <div class="image-upload-container">
                  <div class="image-preview" id="infoImagePreview">
                    <i class="fas fa-image"></i>
                    <span>No image selected</span>
                  </div>
                  <div class="image-upload-controls">
                    <label class="upload-btn">
                      <i class="fas fa-upload"></i> Upload Image
                      <input
                        type="file"
                        id="infoImage"
                        name="infoImage"
                        accept="image/*"
                        hidden
                      />
                    </label>
                  </div>
                </div>
              </div>

              <!-- Info Table Fields -->
              <div class="form-group">
                <label>Info Table Fields</label>
                <div id="infoTableFields" class="info-table-fields">
                  <!-- Empty by default - fields will be added by the user -->
                </div>
                <button type="button" id="addInfoField" class="add-field-btn">
                  <i class="fas fa-plus"></i> Add Field
                </button>
              </div>
            </div>

            <!-- Content Section -->
            <div class="form-section">
              <h3>Content</h3>

              <div id="contentSections" class="content-sections">
                <!-- Initial paragraph section -->
                <div class="content-section paragraph-section">
                  <div class="section-header">
                    <h4>Paragraph</h4>
                    <div class="section-controls">
                      <button type="button" class="remove-section">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="subtitle-0">Subtitle (optional)</label>
                    <input
                      type="text"
                      id="subtitle-0"
                      name="subtitles[]"
                      placeholder="Enter subtitle"
                    />
                  </div>
                  <div class="form-group">
                    <label for="paragraph-0">Paragraph</label>
                    <textarea
                      id="paragraph-0"
                      name="paragraphs[]"
                      rows="4"
                      placeholder="Enter paragraph content"
                    ></textarea>
                  </div>
                </div>
              </div>

              <!-- Add Content Controls -->
              <div class="add-content-controls">
                <button type="button" id="addParagraph" class="add-content-btn">
                  <i class="fas fa-paragraph"></i> Add Paragraph
                </button>
                <button type="button" id="addImage" class="add-content-btn">
                  <i class="fas fa-image"></i> Add Image
                </button>
              </div>
            </div>

            <!-- Submit Section -->
            <div class="form-actions">
              <button type="button" id="previewWiki" class="preview-btn">
                Preview
              </button>
              <button type="submit" class="submit-btn">Create Wiki</button>
            </div>
          </form>
        </section>

        <!-- Manage Wikis Section -->
        <section id="manage-section" class="wiki-manager tab-content">
          <h2>Manage Wikis</h2>

          <!-- Wiki Cards Container -->
          <div class="wiki-cards-container">
            <% if (typeof wikis !== 'undefined' && wikis.length > 0) { %> <%
            wikis.forEach(function(wiki) { %>
            <div class="wiki-card" data-id="<%= wiki._id %>">
              <div class="wiki-card-image">
                <img
                  src="<%= wiki.infoImage?.url || '/images/placeholder.jpg' %>"
                  alt="<%= wiki.title %>"
                />
              </div>
              <div class="wiki-card-content">
                <h3><%= wiki.title %></h3>
                <div class="wiki-card-meta">
                  <span
                    ><i class="fas fa-user"></i> <%= wiki.author || 'Unknown'
                    %></span
                  >
                  <span
                    ><i class="fas fa-clock"></i> <%= new
                    Date(wiki.lastModified).toLocaleDateString() %></span
                  >
                </div>
                <div class="wiki-card-actions">
                  <button class="edit-wiki-btn" data-id="<%= wiki._id %>">
                    <i class="fas fa-edit"></i> Edit
                  </button>
                  <a
                    href="/wiki/<%= wiki.urlSlug %>"
                    class="view-wiki-btn"
                    target="_blank"
                  >
                    <i class="fas fa-eye"></i> View
                  </a>
                </div>
              </div>
            </div>
            <% }); %> <% } else { %>
            <div class="no-wikis-message">
              <i class="fas fa-file-alt"></i>
              <p>No wikis found. Create your first wiki!</p>
            </div>
            <% } %>
          </div>
        </section>

        <!-- ÇüngoTwitter Section -->
        <section id="twitter-section" class="twitter-manager tab-content">
          <div class="twitter-creator">
            <h2>Create New Tweet</h2>

            <form
              id="tweetForm"
              action="/api/tweets"
              method="POST"
              enctype="multipart/form-data"
            >
              <!-- User info section -->
              <div class="form-section">
                <h3>User Information</h3>

                <div class="form-group">
                  <label for="username">Username</label>
                  <input
                    type="text"
                    id="username"
                    name="username"
                    placeholder="Your display name"
                    required
                  />
                  <small
                    >This is the name that will be displayed on your
                    tweets</small
                  >
                </div>

                <div class="form-group">
                  <label for="handle">Handle (@)</label>
                  <input
                    type="text"
                    id="handle"
                    name="handle"
                    placeholder="yourusername"
                    required
                  />
                  <small
                    >Your unique identifier on ÇüngoTwitter (without the @
                    symbol)</small
                  >
                </div>
              </div>

              <!-- Tweet content section -->
              <div class="form-section">
                <h3>Tweet Content</h3>

                <div class="form-group">
                  <label for="tweetText">What's happening?</label>
                  <textarea
                    id="tweetText"
                    name="text"
                    rows="4"
                    maxlength="280"
                    placeholder="Share your thoughts..."
                    required
                  ></textarea>
                  <small class="character-count"
                    >280 characters remaining</small
                  >
                </div>

                <!-- Image upload -->
                <div class="image-upload-container">
                  <label>Add an image (optional)</label>
                  <div class="image-preview" id="tweetImagePreview">
                    <i class="fas fa-image"></i>
                    <p>No image selected</p>
                  </div>

                  <div class="image-upload-controls">
                    <label for="tweetImage" class="upload-btn">
                      <i class="fas fa-upload"></i> Upload New Image
                    </label>
                    <input
                      type="file"
                      id="tweetImage"
                      name="tweetImage"
                      accept="image/*"
                      style="display: none"
                    />
                    <button
                      type="button"
                      id="removeImage"
                      class="remove-image-btn"
                      style="display: none"
                    >
                      <i class="fas fa-trash-alt"></i> Remove Image
                    </button>
                  </div>
                </div>
              </div>

              <!-- Form actions -->
              <div class="form-actions">
                <button type="submit" class="submit-btn">
                  <i class="fas fa-paper-plane"></i> Post Tweet
                </button>
              </div>
            </form>
          </div>

          <!-- Tweet manager section -->
          <div class="twitter-manager">
            <h2>Your Tweets</h2>

            <!-- If there are tweets, display them -->
            <% if (typeof userTweets !== 'undefined' && userTweets.length > 0) {
            %>
            <div class="tweets-dashboard-container">
              <% userTweets.forEach(function(tweet) { %>
              <div class="tweet-dashboard-card">
                <div class="tweet-content">
                  <div class="tweet-header">
                    <span class="username"><%= tweet.username %></span>
                    <span class="handle">@<%= tweet.handle %></span>
                    <span class="timestamp"><%= tweet.timestamp %></span>
                  </div>
                  <div class="tweet-text">
                    <p><%= tweet.text %></p>
                  </div>
                  <% if (tweet.image) { %>
                  <div class="tweet-thumbnail">
                    <img src="<%= tweet.image %>" alt="Tweet image" />
                  </div>
                  <% } %>
                </div>
                <div class="tweet-actions">
                  <button class="edit-tweet-btn" data-id="<%= tweet.id %>">
                    <i class="fas fa-edit"></i> Edit
                  </button>
                  <button class="delete-tweet-btn" data-id="<%= tweet.id %>">
                    <i class="fas fa-trash-alt"></i> Delete
                  </button>
                </div>
              </div>
              <% }); %>
            </div>
            <% } else { %>
            <!-- No tweets message -->
            <div class="no-tweets-message">
              <i class="far fa-comment-dots"></i>
              <p>
                You haven't posted any tweets yet. Create your first tweet
                above!
              </p>
            </div>
            <% } %>

            <div
              class="view-twitter-container"
              style="margin-top: 2rem; text-align: center"
            >
              <a href="/cungotwitter" class="view-twitter-btn">
                <i class="fas fa-external-link-alt"></i> View ÇüngoTwitter
              </a>
            </div>
          </div>
        </section>

        <!-- Photos Section -->
        <section id="photos-section" class="photos-manager tab-content">
          <h2>Manage Photos From Çüngoland</h2>

          <!-- Alert Container -->
          <div id="alertContainer" class="alert-container"></div>

          <!-- Photo Upload Form -->
          <div class="form-section">
            <h3>Upload New Photo</h3>
            <form
              id="photoForm"
              class="photo-form"
              enctype="multipart/form-data"
            >
              <div class="form-group">
                <label for="photoInput">Select Image</label>
                <div class="image-upload-container">
                  <div id="photoPreview" class="image-preview">
                    <i class="fas fa-image"></i>
                  </div>
                  <div class="image-upload-controls">
                    <input
                      type="file"
                      id="photoInput"
                      accept="image/*"
                      class="file-input"
                      style="display: none"
                    />
                    <label for="photoInput" class="upload-btn">
                      <i class="fas fa-upload"></i> Choose Image
                    </label>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="photoDescription">Description</label>
                <textarea
                  id="photoDescription"
                  class="form-control"
                  rows="3"
                  placeholder="Enter a description for this photo"
                ></textarea>
                <small>Describe what this photo shows or represents</small>
              </div>

              <div class="form-actions">
                <button type="submit" id="uploadBtn" class="submit-btn">
                  <i class="fas fa-cloud-upload-alt"></i> Upload Photo
                </button>
              </div>
            </form>
          </div>

          <!-- Photos List -->
          <div class="form-section">
            <h3>Your Photos</h3>
            <div id="photosList" class="photos-list">
              <!-- Photos will be loaded here via JavaScript -->
              <div class="loading-message">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading photos...</p>
              </div>
            </div>
          </div>

          <!-- View All Photos Button -->
          <div class="form-actions" style="text-align: center">
            <a href="/photos-from-cungoland" class="view-all-btn">
              <i class="fas fa-images"></i> View All Photos
            </a>
          </div>
        </section>

        <!-- Edit Wiki Panel (Hidden by default) -->
        <div id="edit-panel" class="edit-panel">
          <div class="edit-panel-content">
            <div class="edit-panel-header">
              <h2>Edit Wiki</h2>
              <button id="close-edit-panel" class="close-btn">
                <i class="fas fa-times"></i>
              </button>
            </div>

            <form
              id="editWikiForm"
              class="wiki-form"
              enctype="multipart/form-data"
            >
              <!-- Hidden Wiki ID -->
              <input type="hidden" id="editWikiId" name="wikiId" />

              <!-- Wiki Title Section -->
              <div class="form-section">
                <h3>Title</h3>
                <div class="form-group">
                  <label for="editWikiTitle">Main Title</label>
                  <input
                    type="text"
                    id="editWikiTitle"
                    name="title"
                    required
                    placeholder="Enter wiki title"
                  />
                  <!-- Hidden input for URL slug -->
                  <input type="hidden" id="editWikiUrlSlug" name="urlSlug" />
                </div>
              </div>

              <!-- Info Table Section -->
              <div class="form-section">
                <h3>Info Table</h3>

                <!-- Info Table Image Upload -->
                <div class="form-group">
                  <label for="editInfoImage">Info Table Image</label>
                  <div class="image-upload-container">
                    <div class="image-preview" id="editInfoImagePreview">
                      <i class="fas fa-image"></i>
                      <span>No image selected</span>
                    </div>
                    <div class="image-upload-controls">
                      <label class="upload-btn">
                        <i class="fas fa-upload"></i> Upload New Image
                        <input
                          type="file"
                          id="editInfoImage"
                          name="infoImage"
                          accept="image/*"
                          hidden
                        />
                      </label>
                    </div>
                  </div>
                </div>

                <!-- Info Table Fields -->
                <div class="form-group">
                  <label>Info Table Fields</label>
                  <div id="editInfoTableFields" class="info-table-fields">
                    <!-- Will be populated dynamically -->
                  </div>
                  <button
                    type="button"
                    id="editAddInfoField"
                    class="add-field-btn"
                  >
                    <i class="fas fa-plus"></i> Add Field
                  </button>
                </div>
              </div>

              <!-- Content Section -->
              <div class="form-section">
                <h3>Content</h3>

                <div id="editContentSections" class="content-sections">
                  <!-- Will be populated dynamically -->
                </div>

                <!-- Add Content Controls -->
                <div class="add-content-controls">
                  <button
                    type="button"
                    id="editAddParagraph"
                    class="add-content-btn"
                  >
                    <i class="fas fa-paragraph"></i> Add Paragraph
                  </button>
                  <button
                    type="button"
                    id="editAddImage"
                    class="add-content-btn"
                  >
                    <i class="fas fa-image"></i> Add Image
                  </button>
                </div>
              </div>

              <!-- Submit Section -->
              <div class="form-actions">
                <button type="button" id="deleteWiki" class="delete-btn">
                  <i class="fas fa-trash"></i> Delete Wiki
                </button>
                <button type="submit" class="submit-btn">Save Changes</button>
              </div>
            </form>
          </div>
        </div>
      </main>
    </div>

    <!-- Templates for dynamic content -->
    <template id="paragraphTemplate">
      <div class="content-section paragraph-section">
        <div class="section-header">
          <h4>Paragraph</h4>
          <div class="section-controls">
            <button type="button" class="remove-section">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
        <div class="form-group">
          <label for="subtitle-{index}">Subtitle (optional)</label>
          <input
            type="text"
            id="subtitle-{index}"
            name="subtitles[]"
            placeholder="Enter subtitle"
          />
        </div>
        <div class="form-group">
          <label for="paragraph-{index}">Paragraph</label>
          <textarea
            id="paragraph-{index}"
            name="paragraphs[]"
            rows="4"
            placeholder="Enter paragraph content"
          ></textarea>
        </div>
      </div>
    </template>

    <template id="imageTemplate">
      <div class="content-section image-section">
        <div class="section-header">
          <h4>Image</h4>
          <div class="section-controls">
            <button type="button" class="remove-section">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
        <div class="form-group">
          <label for="image-caption-{index}">Caption (optional)</label>
          <input
            type="text"
            id="image-caption-{index}"
            name="imageCaptions[]"
            placeholder="Enter image caption"
          />
        </div>
        <div class="form-group">
          <div class="image-upload-container">
            <div class="image-preview content-image-preview">
              <i class="fas fa-image"></i>
              <span>No image selected</span>
            </div>
            <div class="image-upload-controls">
              <label class="upload-btn">
                <i class="fas fa-upload"></i> Upload Image
                <input
                  type="file"
                  name="contentImages[]"
                  accept="image/*"
                  hidden
                />
              </label>
            </div>
          </div>
        </div>
      </div>
    </template>

    <template id="infoFieldTemplate">
      <div class="info-field">
        <input type="text" name="infoLabels[]" placeholder="Label" />
        <input type="text" name="infoValues[]" placeholder="Value" />
        <button type="button" class="remove-field">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </template>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Confirm Deletion</h3>
          <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
          <p>
            Are you sure you want to delete this wiki? This action cannot be
            undone.
          </p>
        </div>
        <div class="modal-footer">
          <button id="cancelDelete" class="cancel-btn">Cancel</button>
          <button id="confirmDelete" class="delete-btn">Delete</button>
        </div>
      </div>
    </div>

    <!-- Edit Tweet Modal -->
    <div id="editTweetModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Edit Tweet</h3>
          <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="editTweetForm">
            <div class="form-group">
              <label for="editTweetText">Edit your tweet</label>
              <textarea
                id="editTweetText"
                name="text"
                rows="4"
                maxlength="280"
                required
              ></textarea>
              <small class="character-count">280 characters remaining</small>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="cancel-btn">Cancel</button>
          <button class="submit-btn" id="updateTweetBtn">Update</button>
        </div>
      </div>
    </div>

    <!-- Delete Tweet Modal -->
    <div id="deleteTweetModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Delete Tweet</h3>
          <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
          <p>
            Are you sure you want to delete this tweet? This action cannot be
            undone.
          </p>
        </div>
        <div class="modal-footer">
          <button class="cancel-btn">Cancel</button>
          <button class="delete-btn" id="confirmDeleteTweet">Delete</button>
        </div>
      </div>
    </div>

    <script src="/js/dashboard.js"></script>
    <script src="/js/cungotwitter.js"></script>
    <script src="/js/photos-manager.js"></script>
  </body>
</html>
